<!doctype html>
{% load static %}
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Gold Vault</title>
    <meta name="description" content="Gold Vault HTML Mobile Template">
    <meta name="keywords"
        content="bootstrap, wallet, banking, fintech mobile template, cordova, phonegap, mobile, html, responsive" />
    <link rel="icon" type="image/png" href="{% static 'assets/img/favicon.png' %}" sizes="32x32">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'assets/img/icon/192x192.png' %}">
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
    {% comment %} <link rel="manifest" href="{% static 'assets/__manifest.json' %}"> {% endcomment %}
    {% comment %} <link rel="manifest" href="/GoldVault/manifest.json/{{request.session.app_data.app_code}}"> {% endcomment %}
    <link rel="manifest" href="{% url 'manifest' request.session.ClientCode %}">

</head>
<style>
    .stats-section .stat-box .title {
        font-size: 13px;   /* smaller label font */
        color: #888;       /* optional softer color */
    }
    .stats-section .stat-box .value {
        font-size: 17px;   /* smaller number font */
        font-weight: 600;  /* still bold for readability */
    }
</style>
<body>
    <!-- loader -->
    <div id="loader">
        <img src="{% static 'assets/img/loading-icon.png' %}" alt="icon" class="loading-icon">
    </div>

    <!-- App Header -->
    <div class="appHeader bg-primary text-light">
        <div class="left">
            <a href="#" class="headerButton" data-bs-toggle="modal" data-bs-target="#sidebarPanel">
                <ion-icon name="menu-outline"></ion-icon>
            </a>
        </div>
        <div class="pageTitle">
            <!-- <img src="{% static 'assets/img/wallet_6592084.png' %}" alt="logo" class="logo" width="60px" height="70px"> -->
            {% comment %} <span style="color: white; font-size: 20px; font-weight: bold;">Gold Vault1  </span> {% endcomment %}
            {% comment %} <span style="color: white; font-size: 20px; font-weight: bold;">{{request.session.DisplayName}}</span> {% endcomment %}
            <span style="color: white; font-size: 20px; font-weight: bold;">
                {{ request.session.BusinessName|default:"Gold Vault" }}
            </span>
        </div>
        <div class="right">
            <!-- Notifications -->
            {% comment %} <a href="#" class="headerButton">
                <ion-icon class="icon" name="notifications-outline"></ion-icon>
                <span class="badge badge-danger">4</span>
            </a> {% endcomment %}

            <a href="{% url 'notification_list' %}" class="headerButton">
                <ion-icon class="icon" name="notifications-outline"></ion-icon>
                {% if unread_count > 0 %}
                    <span class="badge badge-danger">{{ unread_count }}</span>
                {% endif %}
            </a>

            <!-- Profile -->
            {% comment %} <a href="{% url 'setting' %}" class="headerButton">
                <img src="{% static 'assets/img/sample/avatar/avatar1.jpg' %}" alt="image" class="imaged w32">
                <span class="badge badge-danger">6</span>
            </a> {% endcomment %}
            <a href="{% url 'setting' %}" class="headerButton">
                <img src="{% if request.session.user.UserCode %}
                            https://gyaagl.club/GoldVault/static/assets/profile_pic/{{ request.session.user.UserCode }}.png
                        {% else %}
                            {% static 'assets/img/sample/avatar/avatar1.jpg' %}
                        {% endif %}" 
                    alt="{{ request.session.user.UserFullName|default:'User' }}" 
                    class="imaged w32"
                    onerror="this.onerror=null;this.src='{% static 'assets/img/sample/avatar/avatar1.jpg' %}';">

                {% comment %} <img src="{% if request.session.user.UserCode %}/static/assets/profile_pic/{{ request.session.user.UserCode }}.png{% else %}{% static 'assets/img/sample/avatar/avatar1.jpg' %}{% endif %}" 
                    alt="{{ request.session.user.UserFullName|default:'User' }}" 
                    class="imaged w32"
                    onerror="this.onerror=null;this.src='{% static 'assets/img/sample/avatar/avatar1.jpg' %}';"> {% endcomment %}
                {% comment %} <span class="badge badge-danger">6</span> {% endcomment %}
            </a>

            <!-- Logout -->
            {% comment %} <a href="{% url 'logout' %}" class="headerButton">
                <ion-icon class="icon" name="log-out-outline"></ion-icon>
            </a> {% endcomment %}
        </div>
    </div>
    <!-- * App Header -->


    <!-- App Capsule -->
    <div id="appCapsule">

        <!-- Wallet Card -->
        <div class="section wallet-card-section pt-1">
            <div class="wallet-card">
                <!-- Balance -->
                <div class="balance">
                    <div class="left">
                        <span class="title">Gold Rate Per Gram</span>
                        <h1 class="total">₹ {{ sell_rate }}</h1>
                    </div>

                    <div class="right">
                        <a href="#" class="button" data-bs-toggle="modal" data-bs-target="#withdrawActionSheet">
                            <ion-icon name="add-outline"></ion-icon>
                        </a>
                    </div>
                </div>
                <!-- * Balance -->
                <!-- Wallet Footer -->
                <div class="wallet-footer">
                    <div class="item">
                        <a href="#" data-bs-toggle="modal" data-bs-target="#withdrawActionSheet">
                            <div class="icon-wrapper bg-danger">
                                <ion-icon name="arrow-down-outline"></ion-icon>
                            </div>
                            <strong>Buy</strong>
                        </a>
                    </div>
                    <div class="item">
                        <a href="{% url 'get_transection_list' %}" class="link">
                            <div class="icon-wrapper">
                                <ion-icon name="arrow-forward-outline"></ion-icon>
                            </div>
                            <strong>Transactions</strong>
                        </a>
                    </div>

                    <div class="item">
                        <a href="#" data-bs-toggle="modal" data-bs-target="#sendActionSheet">
                            <div class="icon-wrapper">
                                <ion-icon name="arrow-forward-outline"></ion-icon>
                            </div>
                            <strong>Withdraw</strong>
                        </a>
                    </div>

                </div>
                <!-- * Wallet Footer -->
            </div>
        </div>
        <!-- Wallet Card -->

        <!-- Withdraw Action Sheet -->
        <div class="modal fade action-sheet" id="withdrawActionSheet" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" style="font-family: 'Poppins', sans-serif; font-weight: 500; font-size: 17px;">Buy</h5>
                    </div>
                    <div class="modal-body">
                        <div class="action-sheet-content">
                            <form id="buyForm" method="POST" action="{% url 'buy_submit' %}">
                                {% csrf_token %}

                                <!-- Amount Field -->
                                <div class="form-group basic">
                                    <label class="label">Amount (₹)</label>
                                    <div class="input-group mb-2">
                                        <span class="input-group-text">₹</span>
                                        <input type="number" step="0.01" class="form-control" id="amount" name="amount" placeholder="Amount">
                                    </div>
                                </div>

                                <!-- Weight Field -->
                                <div class="form-group basic">
                                    <label class="label">Weight (gm)</label>
                                    <div class="input-group mb-2">
                                        <input type="text" class="form-control" id="weight" name="weight" placeholder="Weight">
                                    </div>
                                </div>

                                <!-- Submit Button -->
                                <div class="form-group basic">
                                    <button type="submit" class="btn btn-block btn-lg" 
                                            style="background-color: #edc88f !important;
                                                border-color:#edc88f !important;
                                                color: black !important;
                                                font-weight: bold;
                                                box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                                        Buy
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- * Withdraw Action Sheet -->

        <!-- Send Action Sheet -->
        <div class="modal fade action-sheet" id="sendActionSheet" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header flex-column align-items-center text-center">
                        <h5 class="modal-title" style="font-family: 'Poppins', sans-serif; font-weight: 500; font-size: 17px;">Withdraw</h5>
                        <small class="text-muted" style="font-family: 'Poppins', sans-serif;">
                            Your Current balance weight is 
                            <strong style="color: #000; font-weight: 700;">{{ stats.current_balance }} gm</strong>
                        </small>
                    </div>

                    <div class="modal-body">
                        <div class="action-sheet-content">
                            <form method="POST" action="{% url 'send_money' %}">
                                {% csrf_token %}

                                <div class="form-group basic">
                                    <label class="label" for="withdraw_weight">Weight</label>
                                    <div class="input-group mb-2">
                                        <input type="number" step="0.00001" min="0" class="form-control" id="withdraw_weight" name="withdraw_weight" value="0" required>
                                    </div>
                                    <!-- error message -->
                                    <small id="weight_error" class="text-danger d-none">Minimum required 1 gm</small>
                                </div>

                                <div class="form-group basic">
                                    <label class="label" for="withdraw_amount">Amount</label>
                                    <div class="input-group mb-2">
                                        <span class="input-group-text">₹</span>
                                        <input type="number" step="0.01" min="0" class="form-control" id="withdraw_amount" name="withdraw_amount" value="0" required>
                                    </div>
                                </div>

                                <div class="form-group basic">
                                    <button type="submit" id="withdraw_btn" class="btn btn-block btn-lg" style="background-color: #edc88f !important; border-color:#edc88f !important;color: black !important;font-weight: bold;box-shadow: 0 4px 8px rgba(0,0,0,0.2);">Withdraw</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- * Send Action Sheet -->

        <!-- Exchange Action Sheet -->
        <div class="modal fade action-sheet" id="exchangeActionSheet" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Exchange Money</h5>
                    </div>
                    <div class="modal-body">
                        <div class="action-sheet-content">
                            <form>
                                <div class="row">
                                    <div class="col-6">
                                        <div class="form-group basic">
                                            <div class="input-wrapper">
                                                <label class="label" for="currency1">From</label>
                                                <select class="form-control custom-select" id="currency1">
                                                    <option value="1">EUR</option>
                                                    <option value="2">USD</option>
                                                    <option value="3">AUD</option>
                                                    <option value="4">CAD</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-group basic">
                                            <div class="input-wrapper">
                                                <label class="label" for="currency2">To</label>
                                                <select class="form-control custom-select" id="currency2">
                                                    <option value="1">USD</option>
                                                    <option value="1">EUR</option>
                                                    <option value="2">AUD</option>
                                                    <option value="3">CAD</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group basic">
                                    <label class="label">Enter Amount</label>
                                    <div class="input-group mb-2">
                                        <span class="input-group-text" id="basic-addon2">$</span>
                                        <input type="text" class="form-control" placeholder="Enter an amount"
                                            value="100">
                                    </div>
                                </div>
                                <div class="form-group basic">
                                    <button type="button" class="btn btn-primary btn-block btn-lg"
                                        data-bs-dismiss="modal">Exchange</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- * Exchange Action Sheet -->

        <!-- Stats -->
        <div class="section stats-section">
            <div class="row mt-2">
                <div class="col-6">
                    <div class="stat-box">
                        <div class="title">Current(Gm)</div>
                        <div class="value" id="current_balance">
                            {{ stats.current_balance }}
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="stat-box">
                        <div class="title">Gain/Loss</div>
                        <div class="value">₹ {{ stats.gain_loss }}</div>
                    </div>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-6">
                    <div class="stat-box">
                        <div class="title">Invested</div>
                        <div class="value">₹ {{ stats.total_invested }}</div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="stat-box">
                        <div class="title">Withdrawal</div>
                        <div class="value">₹ {{ stats.total_withdrwal }}</div>
                    </div>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-6">
                    <div class="stat-box">
                        <div class="title">Purchase(Gm)</div>
                        <div class="value">{{ stats.product_weight }}</div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="stat-box">
                        <div class="title">Withdrawal(Gm)</div>
                        <div class="value"> {{ stats.withdrawl_weight }} </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions -->
       <div class="section mt-4">
            <div class="section-heading" style="display:flex; justify-content:space-between; align-items:center;">
               <h2 class="title" style="color: white;">Transactions</h2>
                <a href="{% url 'get_transection_list' %}" class="link" style="color:white; text-decoration:none;">View All</a>
            </div>

            <div class="transactions" id="transaction-list">
                {% if transactions %}
                    {% for txn in transactions %}
                        <div style="background:#fff; border-radius:10px; padding:12px 15px; margin-bottom:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); display:flex; justify-content:space-between; align-items:center;">
                            
                            <!-- Left: icon + details -->
                            <div style="display:flex; align-items:center;">
                                <!-- Transaction type icon -->
                                {% if txn.TransactionType == '+' %}
                                    <img src="{% static 'assets/img/plus.png' %}" alt="credit" style="width:20px; height:20px; margin-right:10px;">
                                {% else %}
                                    <img src="{% static 'assets/img/minus.png' %}" alt="debit" style="width:20px; height:20px; margin-right:10px;">
                                {% endif %}

                                <div>
                                    <!-- Display Date -->
                                    <div style="font-size:14px; font-weight:bold; color:#333;">
                                        {{ txn.DispplayDate }}
                                    </div>
                                    <!-- Status -->
                                    <div style="font-size:12px; font-weight:600; text-transform:capitalize; color:#958d9e;">
                                        {{ txn.TransactionStatus }}
                                    </div>
                                </div>
                            </div>

                           <!-- Right: Weight -->
                            <div style="font-size:14px; font-weight:bold;
                                {% if txn.TransactionType == '+' %}
                                    color:#27ae60; /* green */
                                {% else %}
                                    color:#f39c12; /* orange */
                                {% endif %}">
                                {% if txn.TransactionType == '+' %}
                                   + {{ txn.Transactioneight }} g
                                {% else %}
                                   - {{ txn.Transactioneight }} g
                                {% endif %}
                            </div>

                        </div>
                    {% endfor %}
                {% else %}
                    <p>No transactions available.</p>
                {% endif %}
            </div>
        </div>



        <!-- app footer -->
        {% comment %} <div class="appFooter">
            <div class="footer-title">       
            </div>
        </div> {% endcomment %}
    </div>
    <!-- * App Capsule -->

    <!-- App Sidebar -->
    <div class="modal fade panelbox panelbox-left" id="sidebarPanel" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body p-0">
                    <!-- profile box -->
                    <div class="profileBox pt-2 pb-2">
                        {% comment %} <div class="image-wrapper">
                            <img src="{% static 'assets/img/sample/avatar/avatar1.jpg' %}" alt="image" class="imaged  w36">
                        </div> {% endcomment %}
                        {% comment %} <div class="image-wrapper">
                            <img src="{% if request.session.user.UserCode %}/static/assets/profile_pic/{{ request.session.user.UserCode }}.png{% else %}{% static 'assets/img/sample/avatar/avatar1.jpg' %}{% endif %}" 
                                alt="{{ request.session.user.UserFullName|default:'User' }}" 
                                class="imaged w36"
                                onerror="this.onerror=null;this.src='{% static 'assets/img/sample/avatar/avatar1.jpg' %}';">
                        </div> {% endcomment %}

                        <div class="image-wrapper">
                            <img src="{% if request.session.user.UserCode %}
                                        https://gyaagl.club/GoldVault/static/assets/profile_pic/{{ request.session.user.UserCode }}.png
                                    {% else %}
                                        {% static 'assets/img/sample/avatar/avatar1.jpg' %}
                                    {% endif %}" 
                                alt="{{ request.session.user.UserFullName|default:'User' }}" 
                                class="imaged w36"
                                onerror="this.onerror=null;this.src='{% static 'assets/img/sample/avatar/avatar1.jpg' %}';">
                        </div>

                        <div class="in">
                            <strong>{{ request.session.user.UserFullName  }}</strong>
                            <div class="text-muted">{{request.session.user.UserMobileNo }}</div>\
                            {% comment %} <strong>{{ user.UserFullName }}</strong>
                            <div class="text-muted">{{ user.UserMobileNo }}</div> {% endcomment %}
                        </div>
                        <a href="#" class="btn btn-link btn-icon sidebar-close" data-bs-dismiss="modal">
                            <ion-icon name="close-outline"></ion-icon>
                        </a>
                    </div>
                    <!-- * profile box -->
                    <!-- balance -->
                    <div class="sidebar-balance">
                        <div class="listview-title">Today's Gold Rate</div>
                        <div class="in">
                            <h1 class="amount">₹{{sell_rate}}</h1>
                        </div>
                    </div>
                    <!-- * balance -->

                    <!-- action group -->
                    <div class="action-group">
                        
                        <a href="#" class="action-button" data-bs-toggle="modal" data-bs-target="#withdrawActionSheet">
                            <div class="in">
                                <div class="iconbox">
                                    <ion-icon name="arrow-down-outline"></ion-icon>
                                </div>
                                Buy
                            </div>
                        </a>

                        <a href="{% url 'get_transection_list' %}" class="action-button">
                            <div class="in">
                                <div class="iconbox">
                                    <ion-icon name="card-outline"></ion-icon>
                                </div>
                                Transactions
                            </div>
                        </a>
                         
                        <a href="#" class="action-button" data-bs-toggle="modal" data-bs-target="#sendActionSheet">
                            <div class="in">
                                <div class="iconbox">
                                    <ion-icon name="arrow-forward-outline"></ion-icon>
                                </div>
                                Withdraw
                            </div>
                        </a>
                        
                    </div>
                    <!-- * action group -->

                    <!-- menu -->
                    <div class="listview-title mt-1">Option</div>
                    <ul class="listview flush transparent no-line image-listview">
                        <li>
                            <a href="{% url 'membershipagrement' %}" class="item">
                                <div class="icon-box bg-primary">
                                    <ion-icon name="people-outline"></ion-icon>
                                </div>
                                <div class="in">
                                    Membership Agreement
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'faq' %}" class="item">
                                <div class="icon-box bg-primary">
                                    <ion-icon name="pie-chart-outline"></ion-icon>
                                </div>
                                <div class="in">
                                    FAQ
                                    <!-- <span class="badge badge-primary">10</span> -->
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'termsofuse' %}" class="item">
                                <div class="icon-box bg-primary">
                                    <ion-icon name="document-text-outline"></ion-icon>
                                </div>
                                <div class="in">
                                    Terms & Use
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'privacypolicy' %}" class="item">
                                <div class="icon-box bg-primary">
                                    <ion-icon name="shield-checkmark-outline"></ion-icon>
                                </div>
                                <div class="in">
                                    Privacy & Policy
                                </div>
                            </a>
                        </li>

                        {% comment %} <li>
                            <a href="{% url 'support_contact' %}" class="item">
                                <div class="icon-box bg-primary">
                                    <ion-icon name="apps-outline"></ion-icon>
                                </div>
                                <div class="in">
                                    Call Our Office(10AM To 9PM)
                                </div>
                            </a>
                        </li> {% endcomment %}
                        <li>
                            <a href="{% url 'setting' %}" class="item">
                                <div class="icon-box bg-primary">
                                    <ion-icon name="card-outline"></ion-icon>
                                </div>
                                <div class="in">
                                    Setting
                                </div>
                            </a>
                        </li>
                    </ul>
                    <!-- * menu -->

                    <!-- others -->
                    <!-- <div class="listview-title mt-1">Others</div> -->
                    <ul class="listview flush transparent no-line image-listview">
                        <li>
                            <a href="{% url 'raise_query' %}" class="item">
                                <div class="icon-box bg-primary">
                                    <ion-icon name="settings-outline"></ion-icon>
                                </div>
                                <div class="in">
                                    Raise A Query
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'old_queries' %}" class="item">
                                <div class="icon-box bg-primary">
                                    <ion-icon name="time-outline"></ion-icon>
                                </div>
                                <div class="in">
                                    Past Queries
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'support_contact' %}" class="item">
                                <div class="icon-box bg-primary">
                                    <ion-icon name="chatbubbles-outline"></ion-icon>
                                </div>
                                <div class="in">
                                    Contact Us
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'logout' %}"class="item">
                                <div class="icon-box bg-primary">
                                    <ion-icon name="log-out-outline"></ion-icon>
                                </div>
                                <div class="in">
                                    Log out
                                </div>
                            </a>
                        </li>
                    </ul>   
                </div>
            </div>
        </div>
    </div>
    <!-- * App Sidebar -->

    <!-- iOS Add to Home Action Sheet -->
    <div class="modal inset fade action-sheet ios-add-to-home" id="ios-add-to-home-screen" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add to Home Screen</h5>
                    <a href="#" class="close-button" data-bs-dismiss="modal">
                        <ion-icon name="close"></ion-icon>
                    </a>
                </div>
                <div class="modal-body">
                    <div class="action-sheet-content text-center">
                        <div class="mb-1"><img src="{% static 'assets/img/icon/192x192.png' %}" alt="image" class="imaged w64 mb-2">
                        </div>
                        <div>
                            Install <strong>Gold Vault</strong> on your iPhone's home screen.
                        </div>
                        <div>
                            Tap <ion-icon name="share-outline"></ion-icon> and Add to homescreen.
                        </div>
                        <div class="mt-2">
                            <button class="btn btn-primary btn-block" data-bs-dismiss="modal">CLOSE</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-- * iOS Add to Home Action Sheet -->

    <!-- Android Add to Home Action Sheet -->
    <div class="modal inset fade action-sheet android-add-to-home" id="android-add-to-home-screen" tabindex="-1"
        role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add to Home Screen</h5>
                    <a href="#" class="close-button" data-bs-dismiss="modal">
                        <ion-icon name="close"></ion-icon>
                    </a>
                </div>
                <div class="modal-body">
                    <div class="action-sheet-content text-center">
                        <div class="mb-1">
                            <img src="{% static 'assets/img/icon/192x192.png' %}" alt="image" class="imaged w64 mb-2">
                        </div>
                        <div>
                            Install <strong>Gold Vault</strong> on your Android's home screen.
                        </div>
                        <div>
                            Tap <ion-icon name="ellipsis-vertical"></ion-icon> and Add to homescreen.
                        </div>
                        <div class="mt-2">
                            <button class="btn btn-primary btn-block" data-bs-dismiss="modal">CLOSE</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- * Android Add to Home Action Sheet -->



    <div id="cookiesbox" class="offcanvas offcanvas-bottom cookies-box" tabindex="-1" data-bs-scroll="true"
        data-bs-backdrop="false">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">We use cookies</h5>
        </div>
        <div class="offcanvas-body">
            <div>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla non lacinia quam. Nulla facilisi.
                <a href="#" class="text-secondary"><u>Learn more</u></a>
            </div>
            <div class="buttons">
                <a href="#" class="btn btn-primary btn-block" data-bs-dismiss="offcanvas">I understand</a>
            </div>
        </div>
    </div>

    <!-- ========= JS Files =========  -->
    <!-- Bootstrap -->
    {% comment %} <script src="{% static 'assets/js/lib/bootstrap.bundle.min.js' %}"></script> {% endcomment %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Ionicons -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/ionicons@latest/dist/ionicons/ionicons.esm.js"></script>
    <!-- Splide -->
    <script src="{% static 'assets/js/plugins/splide/splide.min.js' %}"></script>
    <!-- Base Js File -->
    <script src="{% static 'assets/js/base.js' %}"></script>
   <script>
    let sellRate = parseFloat("{{ sell_rate }}"); // price per gram

    const amountInput = document.getElementById('amount');
    const weightInput = document.getElementById('weight');

    // Helper: keep up to 5 decimals and remove extra zeros
    function formatDecimals(value, decimals) {
        return parseFloat(value).toFixed(decimals);
    }

    // When amount changes, calculate weight (5 decimals)
    amountInput.addEventListener('input', () => {
        let amount = parseFloat(amountInput.value);
        if (!isNaN(amount) && sellRate > 0) {
            weightInput.value = formatDecimals(amount / sellRate, 5);
        } else {
            weightInput.value = '';
        }
    });

    // When weight changes, calculate amount (2 decimals)
    weightInput.addEventListener('input', () => {
        let weight = parseFloat(weightInput.value);
        if (!isNaN(weight) && sellRate > 0) {
            amountInput.value = formatDecimals(weight * sellRate, 2);
        } else {
            amountInput.value = '';
        }
    });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            let sellRate = parseFloat("{{ sell_rate }}"); // price per gram
            let balance = parseFloat("{{ stats.current_balance }}");

            const amountInput = document.getElementById('withdraw_amount');
            const weightInput = document.getElementById('withdraw_weight');
            const withdrawBtn = document.getElementById('withdraw_btn');
            const weightError = document.getElementById('weight_error');

            // Helper: format decimals
            function formatDecimals(value, decimals) {
                return parseFloat(value).toFixed(decimals);
            }

            // Validate minimum weight
            function validateWeight() {
                let weight = parseFloat(weightInput.value);
                if (isNaN(weight) || weight < 1) {
                    withdrawBtn.disabled = true;
                    weightError.classList.remove("d-none");
                } else {
                    // enable only if balance ≥ 1
                    if (balance >= 1) {
                        withdrawBtn.disabled = false;
                    }
                    weightError.classList.add("d-none");
                }
            }

            // When amount changes → calculate weight
            amountInput.addEventListener('input', () => {
                let amount = parseFloat(amountInput.value);
                if (!isNaN(amount) && sellRate > 0) {
                    weightInput.value = formatDecimals(amount / sellRate, 5);
                } else {
                    weightInput.value = '';
                }
                validateWeight();
            });

            // When weight changes → calculate amount
            weightInput.addEventListener('input', () => {
                let weight = parseFloat(weightInput.value);
                if (!isNaN(weight) && sellRate > 0) {
                    amountInput.value = formatDecimals(weight * sellRate, 2);
                } else {
                    amountInput.value = '';
                }
                validateWeight();
            });

            // Disable all if balance < 1
            if (balance < 1) {
                weightInput.disabled = true;
                amountInput.disabled = true;
                withdrawBtn.disabled = true;
            }

            // Run validation initially
            validateWeight();
        });
        </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>

    {% if messages %}
        <script>
            {% for message in messages %}
                var msg = "{{ message|escapejs }}";
                var tag = "{{ message.tags }}";

                {% comment %} console.log(msg);
                console.log(tag); {% endcomment %}
                var alertType = "info";
                var alertTitle = "Info"; 

                if (tag.includes("success")) {
                    alertType = "success";
                    alertTitle = "Success!";
                } else if (tag.includes("danger")) {
                    alertType = "error";
                    alertTitle = "Error!";
                }

                swal({
                    title: alertTitle,
                    text: msg,
                    type: alertType,
                    //timer: 5000,
                    showConfirmButton: true
                });
            {% endfor %}
        </script>
    {% endif %}
</body>

</html>
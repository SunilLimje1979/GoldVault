<!doctype html>
{% load static %}
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Payment Confirmation</title>
  <link rel="icon" type="image/png" href="{% static 'assets/img/favicon.png' %}" sizes="32x32">
  <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
  <script type="module" src="https://cdn.jsdelivr.net/npm/ionicons@latest/dist/ionicons/ionicons.esm.js"></script>
      {% comment %} <link rel="manifest" href="{% static 'assets/__manifest.json' %}"> {% endcomment %}
    {% comment %} <link rel="manifest" href="/GoldVault/manifest.json/{{request.session.app_data.app_code}}"> {% endcomment %}
    <link rel="manifest" href="{% url 'manifest' request.session.ClientCode %}">

  <style>
    body {
      background-color: #121212; /* dark background */
      color: #ffffff; /* white text */
      font-family: 'Poppins', sans-serif;
    }
    .section-title { font-size: 20px; font-weight: 500; margin-bottom: 5px; color: #fff; }
    .order-info { font-size: 12px; margin-bottom: 5px; color: #ddd; }
    .payment-option { margin: 20px 0; }
    .payment-option h5 { font-size: 15px; font-weight: 500; margin-bottom: 4px; color: #fff; }
    .divider { border-bottom: 1px solid #444; margin: 10px 0; }
    .btn-custom {
        background-color:#edc88f !important;
        border-color:#edc88f !important;
        color:black !important;
        border-radius:8px;
        font-weight:600;
    }
    .qr-image { display:block; margin:10px auto; max-width:250px; background:#fff; padding:8px; border-radius:8px; }
    .small-text { font-size: 11px; color: #ece6e6ff; margin-top: 2px; }
    ol { color: #ccc; }
    p, label { color: #ddd; }
  </style>
</head>
<body>

<div class="appHeader">
  <div class="left">
        <a href="{% url 'dashboard1' %}" class="headerButton goBack">
            <ion-icon name="chevron-back-outline"></ion-icon>
        </a>
    </div>
      <div class="pageTitle" style="font-family: 'Poppins', sans-serif; font-size: 17px; font-weight: 500;">
        Payment Confirmation
    </div>
</div>

<div id="appCapsule">

  <div class="section mt-2 px-3">

    <!-- Heading -->
   <div class="section-title" style="text-align:center;">Complete Your Payment</div>
    <div class="order-info" style="text-align:center;">
        OrderId: {{ booking.OrderId }} / Amount: INR {{ booking.BookingAmount|default:100 }}
    </div>
    <div class="order-info" style="text-align:center;">To</div>
    <div class="section-title" style="text-align:center;">{{ booking.BusinessName }}</div>
    <div class="divider" style="margin: 10px auto; text-align:center;"></div>


    <!-- UTR / Transaction Id -->
    <form method="post" action="{% url 'payment_update' %}">
      {% csrf_token %}
      <input type="hidden" name="OrderId" value="{{ booking.OrderId }}">
      <input type="hidden" name="BookingId" value="{{ booking.BookingId }}">
      <div class="form-group basic animated">
        <div class="input-wrapper">
          <label class="label" for="utr">Please provide your UTR / Transaction Id</label>
          <input type="text" class="form-control" id="utr" name="utr" placeholder="Enter UTR / Transaction Id" required>
        </div>
      </div>
      <div class="mt-3">
        <button type="submit" class="btn btn-custom btn-block w-100">Update</button>
      </div>
    </form>
    <div class="small-text">
      The order will automatically expire in <span id="timer">15:00</span> if UTR / Transaction Id is not provided.
    </div>

    <div class="divider"></div>

    <!-- Payment Options -->
    <div class="payment-option">
      <h5>Option 1: Direct Pay</h5>
      <button onclick="openUPILink('{{ booking.UPIURL }}')" class="btn btn-custom btn-block w-100">Pay Now </button>
    </div>

    <div class="payment-option">
      <h5>Option 2: Scan & Pay</h5>
      <img src="https://api.qrserver.com/v1/create-qr-code/?data={{ booking.UPIURL }}&size=250x250"
           alt="QR Code" class="qr-image">
      <ol>
        <li>Scan the above QR code using mobile camera</li>
        <li>Open PhonePe / GPay</li>
        <li>Complete the payment using your app</li>
        <li>Share screenshot to shop or update UTR Id in above box</li>
      </ol>
    </div>

    <div class="payment-option">
      <h5>Option 3: Using UPI Id</h5>
      <p><strong>{{ booking.UPIId }}</strong></p>
      <ol>
        <li>Click here to copy above UPI Id.</li>
        <li>Open PhonePe / GPay app</li>
        <li>Go to Pay by UPI Id</li>
        <li>Paste above UPI Id</li>
        <li>Complete the payment</li>
        <li>Share screenshot or update UTR Id above</li>
      </ol>
    </div>

    <div class="payment-option">
      <h5>Option 4: Bank Transfer</h5>
      <p>
        <b>Account Name:</b> {{ booking.BankAccountName }} <br>
        <b>Account No:</b> {{ booking.BankAccountNo }} <br>
        <b>Bank Name:</b> {{ booking.BankName }} <br>
        <b>Branch Name:</b> {{ booking.BranchName }} <br>
        <b>IFSC Code:</b> {{ booking.IFSCCode }} <br>
        <b>Branch Address:</b> {{ booking.BranchAddress }}
      </p>
      <ol>
        <li>Add above bank account into your payee</li>
        <li>Perform NEFT/RTGS transaction to this account</li>
        <li>Share or update the Transaction Id above</li>
      </ol>
    </div>

  </div>
</div>

<script>
  // Countdown Timer (15 minutes)
  let timer = 15 * 60;
  const timerEl = document.getElementById("timer");
  setInterval(function () {
    let minutes = Math.floor(timer / 60);
    let seconds = timer % 60;
    timerEl.textContent = `${minutes}:${seconds < 10 ? "0" + seconds : seconds}`;
    if (timer > 0) timer--;
  }, 1000);
</script>
<script>
  function openUPILink(upiUrl) {
      // Try to open UPI
      window.location.href = upiUrl;

      // Fallback after 2 sec â†’ redirect to a support page
      setTimeout(() => {
          alert("It looks like UPI is not supported on this device. Please try using a UPI-enabled mobile app.");
          // Or redirect: window.location.href = "/alternative-payment/";
      }, 4000);
  }
</script>
</body>
</html>

<!doctype html>
{% load static %}
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Change PIN</title>
        {% comment %} <link rel="manifest" href="{% static 'assets/__manifest.json' %}"> {% endcomment %}
    {% comment %} <link rel="manifest" href="/GoldVault/manifest.json/{{request.session.app_data.app_code}}"> {% endcomment %}
    <link rel="manifest" href="{% url 'manifest' request.session.ClientCode %}">

    <link rel="icon" type="image/png" href="{% static 'assets/img/favicon.png' %}" sizes="32x32">
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
    <script type="module" src="https://cdn.jsdelivr.net/npm/ionicons@latest/dist/ionicons/ionicons.esm.js"></script>
    <script src="{% static 'assets/js/loader.js' %}"></script>
</head>
<body>

<div class="appHeader">
    <div class="left">
        <a href="{% url 'setting' %}" class="headerButton goBack">
            <ion-icon name="chevron-back-outline"></ion-icon>
        </a>
    </div>
    <div class="pageTitle" style="font-family:'Poppins',sans-serif;font-size:17px;font-weight:500;">
        Change PIN
    </div>
</div>

<div id="appCapsule">
    <div class="section mt-2">
        <form method="post" action="{% url 'change_pin' %}" onsubmit="return validateForm()">
            {% csrf_token %}

            <div class="card">
                <div class="card-body pb-1">

                    <!-- Old PIN -->
                    <div class="form-group basic animated">
                        <div class="input-wrapper">
                            <label class="label" for="old_pin">Old PIN</label>
                            <input type="password" id="old_pin" name="old_pin"
                                class="form-control" placeholder="Your Old PIN"
                                maxlength="4" pattern="\d{4}" inputmode="numeric"
                                oninput="this.value=this.value.replace(/[^0-9]/g,'')" required>
                            <i class="clear-input">
                                <ion-icon name="close-circle"></ion-icon>
                            </i>
                        </div>
                    </div>

                    <!-- New PIN -->
                    <div class="form-group basic animated">
                        <div class="input-wrapper">
                            <label class="label" for="new_pin">New PIN</label>
                            <input type="password" id="new_pin" name="new_pin"
                                class="form-control" placeholder="Your New PIN"
                                maxlength="4" pattern="\d{4}" inputmode="numeric"
                                oninput="this.value=this.value.replace(/[^0-9]/g,'')" required>
                            <i class="clear-input">
                                <ion-icon name="close-circle"></ion-icon>
                            </i>
                        </div>
                    </div>

                    <!-- Confirm New PIN -->
                    <div class="form-group basic animated">
                        <div class="input-wrapper">
                            <label class="label" for="confirm_pin">Confirm PIN</label>
                            <input type="password" id="confirm_pin" name="confirm_pin"
                                class="form-control" placeholder="Confirm New PIN"
                                maxlength="4" pattern="\d{4}" inputmode="numeric"
                                oninput="this.value=this.value.replace(/[^0-9]/g,'')" required>
                            <i class="clear-input">
                                <ion-icon name="close-circle"></ion-icon>
                            </i>
                        </div>
                    </div>

                </div>
            </div>

            <div class="row mt-4">
                <div class="col-12 mb-2 px-4">
                    <button type="submit" class="btn btn-block btn-lg w-100"
                        style="background-color:#edc88f !important;border-color:#edc88f !important;color:black !important;border-radius:8px;font-weight:600;">
                        Update PIN
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- loader -->
<div id="loader" style="display: none;">
    <img src="{% static 'assets/img/loading-icon.png' %}" alt="icon" class="loading-icon">
</div>

<!-- JS -->
<script src="{% static 'assets/js/lib/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'assets/js/base.js' %}"></script>

<!-- Validation -->
<script>
function validateForm() {
    const newPin = document.getElementById("new_pin").value;
    const confirmPin = document.getElementById("confirm_pin").value;
    if (newPin !== confirmPin) {
        alert("New PIN and Confirm PIN do not match!");
        return false;
    }
    return true;
}
</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>

    {% if messages %}
        <script>
            {% for message in messages %}
                var msg = "{{ message|escapejs }}";
                var tag = "{{ message.tags }}";

                {% comment %} console.log(msg);
                console.log(tag); {% endcomment %}
                var alertType = "info";
                var alertTitle = "Info"; 

                if (tag.includes("success")) {
                    alertType = "success";
                    alertTitle = "Success!";
                } else if (tag.includes("danger")) {
                    alertType = "error";
                    alertTitle = "Error!";
                }

                swal({
                    title: alertTitle,
                    text: msg,
                    type: alertType,
                    //timer: 5000,
                    showConfirmButton: true
                });
            {% endfor %}
        </script>
    {% endif %}

</body>
</html>